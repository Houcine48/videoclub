<!DOCTYPE html>
<html>
<head>
    <title>{{ movie.title }}</title>
</head>
<body>
    <div style="padding: 20px; max-width: 800px; margin: auto;">
        
        <!-- INFO DU FILM -->
        <a href="/">← Retour a l'accueil</a>
        <h1>{{ movie.title }}</h1>
        
        {% if movie.youtube_id %}
            <iframe width="100%" height="400" 
                src="https://www.youtube.com/embed/{{ movie.youtube_id }}" 
                frameborder="0" allowfullscreen>
            </iframe>
        {% endif %}

        <p>{{ movie.description }}</p>
        <h3>Prix : {{ movie.price }} EUR</h3>

        <!-- BOUTON LOUER -->
        {% if user.is_authenticated %}
            <a href="{% url 'rent_movie' movie.id %}">
                <button style="background-color: blue; color: white; padding: 10px; cursor: pointer;">LOUER CE FILM</button>
            </a>
            
            <br><br>
            <!-- NOUVEAU : Lien Wishlist -->
            <a href="{% url 'add_wishlist' movie.id %}" style="color: purple; font-weight: bold; text-decoration: none;">
                ♥ Ajouter a ma liste de souhaits
            </a>

        {% else %}
            <a href="{% url 'login' %}"><button>Connectez-vous pour louer</button></a>
        {% endif %}

        <hr>

        <!-- SECTION AVIS -->
        <h2>Avis des utilisateurs</h2>

        <!-- FORMULAIRE (Seulement si connecte) -->
        {% if user.is_authenticated %}
            <div style="background-color: #f9f9f9; padding: 15px; margin-bottom: 20px;">
                <h4>Laisser un avis :</h4>
                <form method="post">
                    {% csrf_token %}
                    <label>Note :</label>
                    <select name="rating">
                        <option value="5">5 etoiles - Excellent</option>
                        <option value="4">4 etoiles - Tres bien</option>
                        <option value="3">3 etoiles - Bien</option>
                        <option value="2">2 etoiles - Moyen</option>
                        <option value="1">1 etoiles - Mauvais</option>
                    </select>
                    <br><br>
                    <textarea name="comment" rows="3" style="width: 100%;" placeholder="Votre commentaire..."></textarea>
                    <br><br>
                    <button type="submit">Publier l'avis</button>
                </form>
            </div>
        {% endif %}

        <!-- LISTE DES AVIS EXISTANTS -->
        {% for review in reviews %}
            <div style="border-bottom: 1px solid #ccc; padding: 10px;">
                <strong>{{ review.user.username }}</strong> - 
                <span style="color: gold; font-weight: bold;">{{ review.rating }}/5</span>
                <p>{{ review.comment }}</p>
            </div>
        {% empty %}
            <p>Aucun avis pour le moment. Soyez le premier !</p>
        {% endfor %}

    </div>
</body>
</html>